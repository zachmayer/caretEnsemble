<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Zach Mayer" />

<meta name="date" content="2014-11-20" />

<title>A brief introduction to caretEnsemble</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">A brief introduction to caretEnsemble</h1>
<h4 class="author"><em>Zach Mayer</em></h4>
<h4 class="date"><em>2014-11-20</em></h4>
</div>


<p><code>caretEnsemble</code> is a package for making ensembles of caret models. You should already be somewhat familiar with the caret package before trying out <code>caretEnsemble</code>.</p>
<p><code>caretEnsemble</code> has 3 primary functions: <strong><code>caretList</code></strong>, <strong><code>caretEnsemble</code></strong> and <strong><code>caretStack</code></strong>. <code>caretList</code> is used to build lists of caret models on the same training data, with the same re-sampling parameters. <code>caretEnsemble</code> and <code>caretStack</code> are used to create ensemble models from such lists of caret models. <code>caretEnsemble</code> uses greedy optimization to create a simple linear blend of models and <code>caretStack</code> uses a caret model to combine the outputs from several component caret models.</p>
<div id="caretlist" class="section level2">
<h2>caretList</h2>
<p><code>caretList</code> is a flexible function for fitting many different caret models, with the same resampling parameters, to the same dataset. It returns a convenient <code>list</code> of caret objects which can later be passed to <code>caretEnsemble</code> and <code>caretStack</code>. <code>caretList</code> has almost exactly the same arguments as <code>train</code> (from the caret package), with the exception that the <code>trControl</code> argument comes last. It can handle both the formula interface and the explicit <code>x</code>, <code>y</code> interface to train. As in caret, the formula interface introduces some overhead and the <code>x</code>, <code>y</code> interface is preferred.</p>
<p><code>caretEnsemble</code> has 2 arguments that can be used to specify which models to fit: <code>methodList</code> and <code>tuneList</code>. <code>methodList</code> is a simple character vector of methods that will be fit with the default <code>train</code> parameters, while <code>tuneList</code> can be used to customize the call to each component model and will be discussed in more detail later. First, lets build an example dataset (adapted from the caret vignette):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Adapted from the caret vignette</span>
<span class="kw">library</span>(<span class="st">'caret'</span>)</code></pre>
<pre><code>## Loading required package: lattice
## Loading required package: ggplot2</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'mlbench'</span>)
<span class="kw">library</span>(<span class="st">'pROC'</span>)</code></pre>
<pre><code>## Type 'citation(&quot;pROC&quot;)' for a citation.
## 
## Attaching package: 'pROC'
## 
## The following objects are masked from 'package:stats':
## 
##     cov, smooth, var</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Sonar)
<span class="kw">set.seed</span>(<span class="dv">107</span>)
inTrain &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(<span class="dt">y =</span> Sonar$Class, <span class="dt">p =</span> .<span class="dv">75</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)
training &lt;-<span class="st"> </span>Sonar[ inTrain,]
testing &lt;-<span class="st"> </span>Sonar[-inTrain,]
my_control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(
  <span class="dt">method=</span><span class="st">'boot'</span>,
  <span class="dt">number=</span><span class="dv">25</span>,
  <span class="dt">savePredictions=</span><span class="ot">TRUE</span>,
  <span class="dt">classProbs=</span><span class="ot">TRUE</span>,
  <span class="dt">index=</span><span class="kw">createResample</span>(training$Class, <span class="dv">25</span>),
  <span class="dt">summaryFunction=</span>twoClassSummary
  )</code></pre>
<p>Notice that we are explicitly setting the resampling <code>index</code> to being used in <code>trainControl</code>. If you do not set this index manually, <code>caretList</code> will attempt to set it for automatically, but it’s generally a good idea to set it yourself.</p>
<p>Now we can use <code>caretList</code> to fit a series of models (each with the same <code>trControl</code>):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'rpart'</span>)
<span class="kw">library</span>(<span class="st">'caretEnsemble'</span>)
model_list &lt;-<span class="st"> </span><span class="kw">caretList</span>(
  Class~., <span class="dt">data=</span>training,
  <span class="dt">trControl=</span>my_control,
  <span class="dt">methodList=</span><span class="kw">c</span>(<span class="st">'glm'</span>, <span class="st">'rpart'</span>)
  )</code></pre>
<p>(As with <code>train</code>, the formula interface is convienent but introduces move overhead. For large datasets the explicitly passing <code>x</code> and <code>y</code> is preferred). We can use the <code>predict.list</code> function to extract predicitons from this object for new data:</p>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">predict</span>(model_list, <span class="dt">newdata=</span><span class="kw">head</span>(testing)))
<span class="kw">print</span>(p)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">glm</th>
<th align="left">rpart</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">M</td>
<td align="left">R</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">M</td>
</tr>
<tr class="odd">
<td align="left">M</td>
<td align="left">M</td>
</tr>
<tr class="even">
<td align="left">M</td>
<td align="left">M</td>
</tr>
<tr class="odd">
<td align="left">M</td>
<td align="left">R</td>
</tr>
<tr class="even">
<td align="left">R</td>
<td align="left">R</td>
</tr>
</tbody>
</table>
<p>If you desire more control over the model fit, use the <code>caretModelSpec</code> to contruct a list of model specifications for the <code>tuneList</code> argument. This argumenent can be used to fit several different variants of the same model, and can also be used to pass arguments through <code>train</code> down to the component functions (e.g. <code>trace=FALSE</code> for <code>nnet</code>):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'mlbench'</span>)
<span class="kw">library</span>(<span class="st">'randomForest'</span>)</code></pre>
<pre><code>## randomForest 4.6-10
## Type rfNews() to see new features/changes/bug fixes.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'nnet'</span>)
model_list_big &lt;-<span class="st"> </span><span class="kw">caretList</span>(
  Class~., <span class="dt">data=</span>training,
  <span class="dt">trControl=</span>my_control,
  <span class="dt">metric=</span><span class="st">'ROC'</span>,
  <span class="dt">methodList=</span><span class="kw">c</span>(<span class="st">'glm'</span>, <span class="st">'rpart'</span>),
  <span class="dt">tuneList=</span><span class="kw">list</span>(
    <span class="dt">rf1=</span><span class="kw">caretModelSpec</span>(<span class="dt">method=</span><span class="st">'rf'</span>, <span class="dt">tuneGrid=</span><span class="kw">data.frame</span>(<span class="dt">.mtry=</span><span class="dv">2</span>)),
    <span class="dt">rf2=</span><span class="kw">caretModelSpec</span>(<span class="dt">method=</span><span class="st">'rf'</span>, <span class="dt">tuneGrid=</span><span class="kw">data.frame</span>(<span class="dt">.mtry=</span><span class="dv">10</span>), <span class="dt">preProcess=</span><span class="st">'pca'</span>),
    <span class="dt">nn=</span><span class="kw">caretModelSpec</span>(<span class="dt">method=</span><span class="st">'nnet'</span>, <span class="dt">tuneLength=</span><span class="dv">2</span>, <span class="dt">trace=</span><span class="ot">FALSE</span>)
  )
)</code></pre>
<p>Finally, you should note that <code>caretList</code> does not support custom caret models. Fitting those models are beyond the scope of this vignette, but if you do so, you can manually add them to the model list (e.g. <code>model_list_big[['my_custom_model']] &lt;- my_custom_model</code>). Just be sure to use the same re-sampling indexes in <code>trControl</code> as you use in the <code>caretList</code> models!</p>
</div>
<div id="caretensemble" class="section level2">
<h2>caretEnsemble</h2>
<p><code>caretList</code> is the preferred way to construct list of caret models in this package, as it will ensure the resampling indexes are identical across all models. Lets take a closer look at our list of models:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>(<span class="kw">resamples</span>(model_list))</code></pre>
<p><img src="data:image/png;base64,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" /></p>
<p>As you can see from this plot, these 2 models are un-correlated, and the rpart model is ocassionally anti-predictive, with a few re-samples showing AUCS around 0.3 to 0.4.</p>
<p>We can confirm the 2 model’s correlation with the <code>modelCor</code> function from caret (caret has a lot of convienent functions for analyzing lists of models):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">modelCor</span>(<span class="kw">resamples</span>(model_list))</code></pre>
<pre><code>##             glm     rpart
## glm   1.0000000 0.5493246
## rpart 0.5493246 1.0000000</code></pre>
<p>These 2 models make a good candidate for an ensemble: their predicitons are fairly un-correlated, but their overall accuaracy is similar. We do a simple, linear greedy optimization on AUC using caretEnsemble:</p>
<pre class="sourceCode r"><code class="sourceCode r">greedy_ensemble &lt;-<span class="st"> </span><span class="kw">caretEnsemble</span>(model_list)
<span class="kw">summary</span>(greedy_ensemble)</code></pre>
<pre><code>## The following models were ensembled: glm, rpart 
## They were weighted: 
## 0.38 0.62
## The resulting AUC is: 0.7632
## The fit for each individual model on the AUC is: 
##  method    metric   metricSD
##     glm 0.6972100 0.07499503
##   rpart 0.7156949 0.06109738</code></pre>
<p>The ensemble’s AUC on the training set resamples is 0.76, which is about 7% better than the best individual model. We can confirm this finding on the test set:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'caTools'</span>)
model_preds &lt;-<span class="st"> </span><span class="kw">lapply</span>(model_list, predict, <span class="dt">newdata=</span>testing, <span class="dt">type=</span><span class="st">'prob'</span>)
model_preds &lt;-<span class="st"> </span><span class="kw">lapply</span>(model_preds, function(x) x[,<span class="st">'M'</span>])
model_preds &lt;-<span class="st"> </span><span class="kw">data.frame</span>(model_preds)
ens_preds &lt;-<span class="st"> </span><span class="kw">predict</span>(greedy_ensemble, <span class="dt">newdata=</span>testing)
model_preds$ensemble &lt;-<span class="st"> </span>ens_preds
<span class="kw">colAUC</span>(model_preds, testing$Class)</code></pre>
<pre><code>##               glm     rpart  ensemble
## M vs. R 0.6496914 0.6566358 0.6983025</code></pre>
<p>The ensemble’s AUC on the test set is about 6% higher than the best individual model.</p>
<p>We can also use varImp to extract the variable importances from each member of the ensemble, as well as the final ensemble model:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">varImp</span>(greedy_ensemble)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">variable</th>
<th align="right">glm</th>
<th align="right">rpart</th>
<th align="right">ensemble</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">V1</td>
<td align="right">1.1333169</td>
<td align="right">0.000000</td>
<td align="right">0.4306604</td>
</tr>
<tr class="even">
<td align="left">V2</td>
<td align="right">3.0996403</td>
<td align="right">0.000000</td>
<td align="right">1.1778633</td>
</tr>
<tr class="odd">
<td align="left">V3</td>
<td align="right">2.8104353</td>
<td align="right">0.000000</td>
<td align="right">1.0679654</td>
</tr>
<tr class="even">
<td align="left">V4</td>
<td align="right">2.6724900</td>
<td align="right">0.000000</td>
<td align="right">1.0155462</td>
</tr>
<tr class="odd">
<td align="left">V5</td>
<td align="right">0.0612158</td>
<td align="right">0.000000</td>
<td align="right">0.0232620</td>
</tr>
<tr class="even">
<td align="left">V6</td>
<td align="right">0.9468313</td>
<td align="right">0.000000</td>
<td align="right">0.3597959</td>
</tr>
<tr class="odd">
<td align="left">V7</td>
<td align="right">1.1944628</td>
<td align="right">0.000000</td>
<td align="right">0.4538959</td>
</tr>
<tr class="even">
<td align="left">V8</td>
<td align="right">2.9547546</td>
<td align="right">0.000000</td>
<td align="right">1.1228068</td>
</tr>
<tr class="odd">
<td align="left">V9</td>
<td align="right">3.2537912</td>
<td align="right">15.416273</td>
<td align="right">10.7945297</td>
</tr>
<tr class="even">
<td align="left">V10</td>
<td align="right">0.3012508</td>
<td align="right">11.979705</td>
<td align="right">7.5418927</td>
</tr>
<tr class="odd">
<td align="left">V11</td>
<td align="right">0.5166883</td>
<td align="right">17.132903</td>
<td align="right">10.8187413</td>
</tr>
<tr class="even">
<td align="left">V12</td>
<td align="right">1.3496604</td>
<td align="right">15.256820</td>
<td align="right">9.9720990</td>
</tr>
<tr class="odd">
<td align="left">V13</td>
<td align="right">0.9620234</td>
<td align="right">10.300580</td>
<td align="right">6.7519283</td>
</tr>
<tr class="even">
<td align="left">V14</td>
<td align="right">1.1891755</td>
<td align="right">0.000000</td>
<td align="right">0.4518867</td>
</tr>
<tr class="odd">
<td align="left">V15</td>
<td align="right">0.3819398</td>
<td align="right">5.776464</td>
<td align="right">3.7265448</td>
</tr>
<tr class="even">
<td align="left">V16</td>
<td align="right">0.2577508</td>
<td align="right">7.754766</td>
<td align="right">4.9059005</td>
</tr>
<tr class="odd">
<td align="left">V17</td>
<td align="right">0.8271323</td>
<td align="right">6.173673</td>
<td align="right">4.1419874</td>
</tr>
<tr class="even">
<td align="left">V18</td>
<td align="right">0.3369883</td>
<td align="right">6.022617</td>
<td align="right">3.8620780</td>
</tr>
<tr class="odd">
<td align="left">V19</td>
<td align="right">3.0106838</td>
<td align="right">0.000000</td>
<td align="right">1.1440598</td>
</tr>
<tr class="even">
<td align="left">V20</td>
<td align="right">4.2131978</td>
<td align="right">0.000000</td>
<td align="right">1.6010151</td>
</tr>
<tr class="odd">
<td align="left">V21</td>
<td align="right">3.5798764</td>
<td align="right">0.000000</td>
<td align="right">1.3603530</td>
</tr>
<tr class="even">
<td align="left">V22</td>
<td align="right">2.7322766</td>
<td align="right">0.000000</td>
<td align="right">1.0382651</td>
</tr>
<tr class="odd">
<td align="left">V23</td>
<td align="right">1.0892770</td>
<td align="right">0.000000</td>
<td align="right">0.4139253</td>
</tr>
<tr class="even">
<td align="left">V24</td>
<td align="right">2.2190151</td>
<td align="right">0.000000</td>
<td align="right">0.8432257</td>
</tr>
<tr class="odd">
<td align="left">V25</td>
<td align="right">1.4311691</td>
<td align="right">0.000000</td>
<td align="right">0.5438443</td>
</tr>
<tr class="even">
<td align="left">V26</td>
<td align="right">0.4463702</td>
<td align="right">0.000000</td>
<td align="right">0.1696207</td>
</tr>
<tr class="odd">
<td align="left">V27</td>
<td align="right">0.5780564</td>
<td align="right">4.186200</td>
<td align="right">2.8151054</td>
</tr>
<tr class="even">
<td align="left">V28</td>
<td align="right">0.4616641</td>
<td align="right">0.000000</td>
<td align="right">0.1754324</td>
</tr>
<tr class="odd">
<td align="left">V29</td>
<td align="right">0.6984145</td>
<td align="right">0.000000</td>
<td align="right">0.2653975</td>
</tr>
<tr class="even">
<td align="left">V30</td>
<td align="right">3.3782158</td>
<td align="right">0.000000</td>
<td align="right">1.2837220</td>
</tr>
<tr class="odd">
<td align="left">V31</td>
<td align="right">4.7123197</td>
<td align="right">0.000000</td>
<td align="right">1.7906815</td>
</tr>
<tr class="even">
<td align="left">V32</td>
<td align="right">1.5762180</td>
<td align="right">0.000000</td>
<td align="right">0.5989628</td>
</tr>
<tr class="odd">
<td align="left">V33</td>
<td align="right">1.0562030</td>
<td align="right">0.000000</td>
<td align="right">0.4013571</td>
</tr>
<tr class="even">
<td align="left">V34</td>
<td align="right">3.8445765</td>
<td align="right">0.000000</td>
<td align="right">1.4609391</td>
</tr>
<tr class="odd">
<td align="left">V35</td>
<td align="right">4.7097589</td>
<td align="right">0.000000</td>
<td align="right">1.7897084</td>
</tr>
<tr class="even">
<td align="left">V36</td>
<td align="right">2.8446737</td>
<td align="right">0.000000</td>
<td align="right">1.0809760</td>
</tr>
<tr class="odd">
<td align="left">V37</td>
<td align="right">0.9291063</td>
<td align="right">0.000000</td>
<td align="right">0.3530604</td>
</tr>
<tr class="even">
<td align="left">V38</td>
<td align="right">0.7438946</td>
<td align="right">0.000000</td>
<td align="right">0.2826799</td>
</tr>
<tr class="odd">
<td align="left">V39</td>
<td align="right">0.6709937</td>
<td align="right">0.000000</td>
<td align="right">0.2549776</td>
</tr>
<tr class="even">
<td align="left">V40</td>
<td align="right">0.6935602</td>
<td align="right">0.000000</td>
<td align="right">0.2635529</td>
</tr>
<tr class="odd">
<td align="left">V41</td>
<td align="right">2.8604649</td>
<td align="right">0.000000</td>
<td align="right">1.0869767</td>
</tr>
<tr class="even">
<td align="left">V42</td>
<td align="right">4.5521294</td>
<td align="right">0.000000</td>
<td align="right">1.7298092</td>
</tr>
<tr class="odd">
<td align="left">V43</td>
<td align="right">0.1451172</td>
<td align="right">0.000000</td>
<td align="right">0.0551445</td>
</tr>
<tr class="even">
<td align="left">V44</td>
<td align="right">1.4977606</td>
<td align="right">0.000000</td>
<td align="right">0.5691490</td>
</tr>
<tr class="odd">
<td align="left">V45</td>
<td align="right">0.2963071</td>
<td align="right">0.000000</td>
<td align="right">0.1125967</td>
</tr>
<tr class="even">
<td align="left">V46</td>
<td align="right">0.4392124</td>
<td align="right">0.000000</td>
<td align="right">0.1669007</td>
</tr>
<tr class="odd">
<td align="left">V47</td>
<td align="right">0.9161909</td>
<td align="right">0.000000</td>
<td align="right">0.3481525</td>
</tr>
<tr class="even">
<td align="left">V48</td>
<td align="right">3.1502310</td>
<td align="right">0.000000</td>
<td align="right">1.1970878</td>
</tr>
<tr class="odd">
<td align="left">V49</td>
<td align="right">2.0082597</td>
<td align="right">0.000000</td>
<td align="right">0.7631387</td>
</tr>
<tr class="even">
<td align="left">V50</td>
<td align="right">3.6268111</td>
<td align="right">0.000000</td>
<td align="right">1.3781882</td>
</tr>
<tr class="odd">
<td align="left">V51</td>
<td align="right">1.6816694</td>
<td align="right">0.000000</td>
<td align="right">0.6390344</td>
</tr>
<tr class="even">
<td align="left">V52</td>
<td align="right">0.9801068</td>
<td align="right">0.000000</td>
<td align="right">0.3724406</td>
</tr>
<tr class="odd">
<td align="left">V53</td>
<td align="right">0.0955147</td>
<td align="right">0.000000</td>
<td align="right">0.0362956</td>
</tr>
<tr class="even">
<td align="left">V54</td>
<td align="right">1.7373624</td>
<td align="right">0.000000</td>
<td align="right">0.6601977</td>
</tr>
<tr class="odd">
<td align="left">V55</td>
<td align="right">0.4035841</td>
<td align="right">0.000000</td>
<td align="right">0.1533620</td>
</tr>
<tr class="even">
<td align="left">V56</td>
<td align="right">1.8294611</td>
<td align="right">0.000000</td>
<td align="right">0.6951952</td>
</tr>
<tr class="odd">
<td align="left">V57</td>
<td align="right">0.3157968</td>
<td align="right">0.000000</td>
<td align="right">0.1200028</td>
</tr>
<tr class="even">
<td align="left">V58</td>
<td align="right">1.7584441</td>
<td align="right">0.000000</td>
<td align="right">0.6682088</td>
</tr>
<tr class="odd">
<td align="left">V59</td>
<td align="right">1.8365071</td>
<td align="right">0.000000</td>
<td align="right">0.6978727</td>
</tr>
<tr class="even">
<td align="left">V60</td>
<td align="right">0.0000000</td>
<td align="right">0.000000</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">(The column</td>
<td align="right">s each sum u</td>
<td align="right">p to 100.)</td>
<td align="right"></td>
</tr>
</tbody>
</table>
</div>
<div id="caretstack" class="section level2">
<h2>caretStack</h2>
<p>caretStack allows us to move beyond simple blends of models to using “meta-models” to ensemble collections of predictive models. DO NOT use the <code>trainControl</code> object you used to fit the training models to fit the ensemble. The re-sampling indexes will be wrong. Fortunately, you don’t need to be fastidious with re-sampling indexes for caretStack, as it only fits one model, and the defaults <code>train</code> uses will usually work fine:</p>
<pre class="sourceCode r"><code class="sourceCode r">glm_ensemble &lt;-<span class="st"> </span><span class="kw">caretStack</span>(
  model_list, 
  <span class="dt">method=</span><span class="st">'glm'</span>,
  <span class="dt">metric=</span><span class="st">'ROC'</span>,
  <span class="dt">trControl=</span><span class="kw">trainControl</span>(
    <span class="dt">method=</span><span class="st">'boot'</span>,
    <span class="dt">number=</span><span class="dv">10</span>,
    <span class="dt">savePredictions=</span><span class="ot">TRUE</span>,
    <span class="dt">classProbs=</span><span class="ot">TRUE</span>,
    <span class="dt">summaryFunction=</span>twoClassSummary
  )
)
model_preds2 &lt;-<span class="st"> </span>model_preds
model_preds2$ensemble &lt;-<span class="st"> </span><span class="kw">predict</span>(glm_ensemble, <span class="dt">newdata=</span>testing, <span class="dt">type=</span><span class="st">'prob'</span>)$M
CF &lt;-<span class="st"> </span><span class="kw">coef</span>(glm_ensemble$ens_model$finalModel)[-<span class="dv">1</span>]
<span class="kw">colAUC</span>(model_preds2, testing$Class)</code></pre>
<pre><code>##               glm     rpart ensemble
## M vs. R 0.6496914 0.6566358 0.695216</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">CF/<span class="kw">sum</span>(CF)</code></pre>
<pre><code>##       glm     rpart 
## 0.3535492 0.6464508</code></pre>
<p>Note that <code>glm_ensemble$ens_model</code> is a regular caret object of class <code>train</code>. The glm-weighted model weights (glm vs rpart) and test-set AUCs are extremely similar to the caretEnsemble greedy optimization.</p>
<p>We can also use more sophisticated ensembles than simple linear weights, but these models are much more succeptible to over-fitting, and generally require large sets of resamples to train on (n=50 or higher for bootstrap samples). Lets try one anyways:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'gbm'</span>)</code></pre>
<pre><code>## Loading required package: survival
## Loading required package: splines
## 
## Attaching package: 'survival'
## 
## The following object is masked from 'package:caret':
## 
##     cluster
## 
## Loading required package: parallel
## Loaded gbm 2.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">gbm_ensemble &lt;-<span class="st"> </span><span class="kw">caretStack</span>(
  model_list, 
  <span class="dt">method=</span><span class="st">'gbm'</span>,
  <span class="dt">verbose=</span><span class="ot">FALSE</span>,
  <span class="dt">tuneLength=</span><span class="dv">10</span>,
  <span class="dt">metric=</span><span class="st">'ROC'</span>,
  <span class="dt">trControl=</span><span class="kw">trainControl</span>(
    <span class="dt">method=</span><span class="st">'boot'</span>,
    <span class="dt">number=</span><span class="dv">10</span>,
    <span class="dt">savePredictions=</span><span class="ot">TRUE</span>,
    <span class="dt">classProbs=</span><span class="ot">TRUE</span>,
    <span class="dt">summaryFunction=</span>twoClassSummary
  )
)</code></pre>
<pre><code>## Loading required package: plyr</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">model_preds3 &lt;-<span class="st"> </span>model_preds
model_preds3$ensemble &lt;-<span class="st"> </span><span class="kw">predict</span>(gbm_ensemble, <span class="dt">newdata=</span>testing, <span class="dt">type=</span><span class="st">'prob'</span>)$M
<span class="kw">colAUC</span>(model_preds3, testing$Class)</code></pre>
<pre><code>##               glm     rpart  ensemble
## M vs. R 0.6496914 0.6566358 0.6944444</code></pre>
<p>In this case, the sophisticated ensemble is no better than a simple weighted linear combination. Non-linar ensembles seem to work best when you have:</p>
<ol style="list-style-type: decimal">
<li>Lots of data.</li>
<li>Lots of models with similar accuracies.</li>
<li>Your models are very un-correllated: each one seems to capture a different aspect of the data.</li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
