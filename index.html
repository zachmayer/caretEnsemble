<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Ensembles of Caret Models â€¢ caretEnsemble</title>
<script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Ensembles of Caret Models">
<meta name="description" content="Functions for creating ensembles of caret models: caretList() and caretStack(). caretList() is a convenience function for fitting multiple caret::train() models to the same dataset. caretStack() will make linear or non-linear combinations of these models, using a caret::train() model as a meta-model.">
<meta property="og:description" content="Functions for creating ensembles of caret models: caretList() and caretStack(). caretList() is a convenience function for fitting multiple caret::train() models to the same dataset. caretStack() will make linear or non-linear combinations of these models, using a caret::train() model as a meta-model.">
<meta property="og:image" content="http://zachmayer.github.io/caretEnsemble/reference/figures/README-greedy-stack-6-plot.png">
<meta property="og:image:alt" content="6 panel plot of an ensemble of models fit to the diamonds dataset. The RF model is the best and has the highest weight. The residual plots look good.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">caretEnsemble</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/caretEnsemble-intro.html">A Brief Introduction to caretEnsemble</a></li>
    <li><a class="dropdown-item" href="articles/Version-4.0-New-Features.html">Version 4.0 New Features</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/zachmayer/caretEnsemble/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="caretensemble">caretEnsemble<a class="anchor" aria-label="anchor" href="#caretensemble"></a>
</h1></div>
<!-- badges: start -->

<p>caretEnsemble is a framework for <a href="https://en.wikipedia.org/wiki/Ensemble_learning#Stacking" class="external-link">stacking</a> models fit with the <a href="https://topepo.github.io/caret/" class="external-link">caret</a> package.</p>
<p>Use <code>caretList</code> to fit multiple models, and then use <code>caretStack</code> to stack them with another caret model.</p>
<p>First, use caretList to fit many models to the same data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">diamonds</span>, package <span class="op">=</span> <span class="st">"ggplot2"</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>, <span class="fl">500L</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="reference/caretList.html">caretList</a></span><span class="op">(</span></span>
<span>  <span class="va">price</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rf"</span>, <span class="st">"glmnet"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rf, glmnet  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name metric    value       sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt; &lt;char&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:         rf   RMSE 1076.492 215.4737</span></span>
<span><span class="co">#&gt; 2:     glmnet   RMSE 1142.082 105.6022</span></span></code></pre></div>
<p>Then, use caretEnsemble to make a greedy ensemble of these models</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">greedy_stack</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">greedy_stack</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rf, glmnet  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; caret::train model:</span></span>
<span><span class="co">#&gt; Greedy Mean Squared Error Optimizer </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 400, 400, 400, 400, 400 </span></span>
<span><span class="co">#&gt; Resampling results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   RMSE      Rsquared   MAE     </span></span>
<span><span class="co">#&gt;   969.2517  0.9406218  557.1987</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tuning parameter 'max_iter' was held constant at a value of 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final model:</span></span>
<span><span class="co">#&gt; Greedy MSE</span></span>
<span><span class="co">#&gt; RMSE:  989.2085 </span></span>
<span><span class="co">#&gt; Weights:</span></span>
<span><span class="co">#&gt;        [,1]</span></span>
<span><span class="co">#&gt; rf     0.55</span></span>
<span><span class="co">#&gt; glmnet 0.45</span></span></code></pre></div>
<p>You can also use caretStack to make a non-linear ensemble</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_stack</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="reference/caretStack.html">caretStack</a></span><span class="op">(</span><span class="va">models</span>, method <span class="op">=</span> <span class="st">"rf"</span><span class="op">)</span></span>
<span><span class="co">#&gt; note: only 1 unique complexity parameters in default grid. Truncating the grid to 1 .</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rf_stack</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rf, glmnet  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; caret::train model:</span></span>
<span><span class="co">#&gt; Random Forest </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 400, 400, 400, 400, 400 </span></span>
<span><span class="co">#&gt; Resampling results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   RMSE      Rsquared  MAE     </span></span>
<span><span class="co">#&gt;   1081.425  0.930012  540.3294</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tuning parameter 'mtry' was held constant at a value of 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt;  randomForest(x = x, y = y, mtry = param$mtry) </span></span>
<span><span class="co">#&gt;                Type of random forest: regression</span></span>
<span><span class="co">#&gt;                      Number of trees: 500</span></span>
<span><span class="co">#&gt; No. of variables tried at each split: 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Mean of squared residuals: 925377</span></span>
<span><span class="co">#&gt;                     % Var explained: 93.95</span></span></code></pre></div>
<p>Use autoplot from ggplot2 to plot ensemble diagnostics:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">greedy_stack</span>, training_data <span class="op">=</span> <span class="va">dat</span>, xvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carat"</span>, <span class="st">"table"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-greedy-stack-6-plot-1.png" alt="6 panel plot of an ensemble of models fit to the diamonds dataset. The RF model is the best and has the highest weight. The residual plots look good. RMSE is about `r round(min(greedy_stack$ens_model$results$RMSE))`." width="100%"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">rf_stack</span>, training_data <span class="op">=</span> <span class="va">dat</span>, xvars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"carat"</span>, <span class="st">"table"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" alt="6 panel plot of an ensemble of models fit to the diamonds dataset. The RF model is the best and has the highest weight. The residual plots look good. RMSE is about `r round(min(rf_stack$ens_model$results$RMSE))`." width="100%"></p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="section level3">
<h3 id="install-the-stable-version-from-cran">Install the stable version from <a href="https://CRAN.R-project.org/package=caretEnsemble/" class="external-link">CRAN</a>:<a class="anchor" aria-label="anchor" href="#install-the-stable-version-from-cran"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"caretEnsemble"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="install-the-dev-version-from-github">Install the dev version from github:<a class="anchor" aria-label="anchor" href="#install-the-dev-version-from-github"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"zachmayer/caretEnsemble"</span><span class="op">)</span></span></code></pre></div>
<p>There are also tagged versions of caretEnsemble on github you can install via devtools. For example, to install the <a href="https://github.com/zachmayer/caretEnsemble/releases/" class="external-link">previous release of caretEnsemble</a> use:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"zachmayer/caretEnsemble@2.0.3"</span><span class="op">)</span></span></code></pre></div>
<p>This is useful if the latest release breaks some aspect of your workflow. caretEnsemble is pure R with no compilation, so this command will work in a variety of environments.</p>
</div>
</div>
<div class="section level1">
<h1 id="package-development">Package development<a class="anchor" aria-label="anchor" href="#package-development"></a>
</h1>
<p>This package uses a Makefile. Use <code>make help</code> to see the supported options.</p>
<p>Use <code>make fix-style</code> to fix simple linting errors.</p>
<p>For iterating while writing code, run <code>make dev</code>. This runs just <code>make clean fix-style document lint spell test</code>, for a quicker local dev loop. Please still run <code>make all</code> before making a PR.</p>
<p>Use <code>make all</code> before making a pull request, which will also run R CMD CHECK and a code coverage check. This runs <code>make clean fix-style document install build-readme build-vignettes lint spell test check coverage preview-site</code>.</p>
<div class="section level2">
<h2 id="first-time-dev-setup">First time dev setup:<a class="anchor" aria-label="anchor" href="#first-time-dev-setup"></a>
</h2>
<p>run <code>make install</code> from the git repository to install the dev version of caretEnsemble, along with the necessary package dependencies. # Inspiration and similar packages: caretEnsemble was inspired by <a href="https://github.com/mewo2/medley" class="external-link">medley</a>, which in turn was inspired by Caruana et. al.â€™s (2004) paper <a href="http://www.cs.cornell.edu/~caruana/ctp/ct.papers/caruana.icml04.icdm06long.pdf" class="external-link">Ensemble Selection from Libraries of Models.</a></p>
<p>If you want to do something similar in python, check out <a href="https://github.com/vecxoz/vecstack" class="external-link">vecstack</a>.</p>
</div>
</div>
<div class="section level1">
<h1 id="code-of-conduct">Code of Conduct:<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h1>
<p>Please note that this project is released with a <a href="https://github.com/zachmayer/caretEnsemble/blob/master/.github/CONTRIBUTING.md" class="external-link">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=caretEnsemble" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/zachmayer/caretEnsemble/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/zachmayer/caretEnsemble/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing caretEnsemble</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Zachary A. Deane-Mayer <br><small class="roles"> Author, maintainer, copyright holder </small>  </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=caretEnsemble" class="external-link"><img src="https://www.r-pkg.org/badges/version/caretEnsemble" alt="CRAN version"></a></li>
<li><a href="https://cran.r-project.org/web/checks/check_results_caretEnsemble.html" class="external-link"><img src="https://badges.cranchecks.info/worst/caretEnsemble.svg" alt="CRAN status"></a></li>
<li><a href="https://www.rdocumentation.org/packages/caretEnsemble" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/last-month/caretEnsemble" alt="CRAN Downloads"></a></li>
<li><a href="https://github.com/zachmayer/caretEnsemble/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/zachmayer/caretEnsemble/actions/workflows/R-CMD-check.yaml/badge.svg?branch=main" alt="R-CMD-check"></a></li>
<li><a href="https://github.com/zachmayer/caretEnsemble/actions/workflows/tests.yaml" class="external-link"><img src="https://github.com/zachmayer/caretEnsemble/actions/workflows/tests.yaml/badge.svg?branch=main" alt="Tests"></a></li>
<li><a href="https://codecov.io/gh/zachmayer/caretEnsemble" class="external-link"><img src="https://codecov.io/gh/zachmayer/caretEnsemble/graph/badge.svg?token=IEtOlZDYMs" alt="Code Coverage"></a></li>
<li><a href="https://www.codefactor.io/repository/github/zachmayer/caretEnsemble" class="external-link"><img src="https://www.codefactor.io/repository/github/zachmayer/caretEnsemble/badge" alt="CodeFactor"></a></li>
<li><a href="https://zachmayer.r-universe.dev/caretEnsemble" class="external-link"><img src="https://zachmayer.r-universe.dev/badges/caretEnsemble" alt="r-universe status badge"></a></li>
<li><a href="https://github.com/zachmayer/caretEnsemble" class="external-link"><img src="https://img.shields.io/github/languages/code-size/zachmayer/caretEnsemble.svg" alt="Code Size"></a></li>
<li><a href="https://badges.mit-license.org" class="external-link"><img src="http://img.shields.io/:license-mit-blue.svg?style=flat" alt="License"></a></li>
<li><a href="https://discord.gg/zgPeSm8a3u" class="external-link"><img src="https://img.shields.io/discord/1255535052578619524" alt="Discord"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary A. Deane-Mayer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
