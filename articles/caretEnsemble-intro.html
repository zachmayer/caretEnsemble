<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Brief Introduction to caretEnsemble • caretEnsemble</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="A Brief Introduction to caretEnsemble">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">caretEnsemble</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/caretEnsemble-intro.html">A Brief Introduction to caretEnsemble</a></li>
    <li><a class="dropdown-item" href="../articles/Version-4.0-New-Features.html">Version 4.0 New Features</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/zachmayer/caretEnsemble/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>A Brief Introduction to caretEnsemble</h1>
                        <h4 data-toc-skip class="author">Zach
Deane-Mayer</h4>
            
            <h4 data-toc-skip class="date">2024-08-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/zachmayer/caretEnsemble/blob/main/vignettes/caretEnsemble-intro.Rmd" class="external-link"><code>vignettes/caretEnsemble-intro.Rmd</code></a></small>
      <div class="d-none name"><code>caretEnsemble-intro.Rmd</code></div>
    </div>

    
    
<p><code>caretEnsemble</code> is a package for making ensembles of caret
models. You should already be somewhat familiar with the caret package
before trying out <code>caretEnsemble</code>.</p>
<p><code>caretEnsemble</code> has 3 primary functions:
<strong><code>caretList</code></strong>,
<strong><code>caretEnsemble</code></strong> and
<strong><code>caretStack</code></strong>. <code>caretList</code> is used
to build lists of caret models on the same training data, with the same
re-sampling parameters. <code>caretEnsemble</code> and
<code>caretStack</code> are used to create ensemble models from such
lists of caret models. <code>caretEnsemble</code> uses a glm to create a
simple linear blend of models and <code>caretStack</code> uses a caret
model to combine the outputs from several component caret models.</p>
<div class="section level2">
<h2 id="caretlist">caretList<a class="anchor" aria-label="anchor" href="#caretlist"></a>
</h2>
<p><code>caretList</code> is a flexible function for fitting many
different caret models, with the same resampling parameters, to the same
dataset. It returns a convenient <code>list</code> of caret objects
which can later be passed to <code>caretEnsemble</code> and
<code>caretStack</code>. <code>caretList</code> has almost exactly the
same arguments as <code>train</code> (from the caret package), with the
exception that the <code>trControl</code> argument comes last. It can
handle both the formula interface and the explicit <code>x</code>,
<code>y</code> interface to train. As in caret, the formula interface
introduces some overhead and the <code>x</code>, <code>y</code>
interface is preferred.</p>
<p><code>caretEnsemble</code> has 2 arguments that can be used to
specify which models to fit: <code>methodList</code> and
<code>tuneList</code>. <code>methodList</code> is a simple character
vector of methods that will be fit with the default <code>train</code>
parameters, while <code>tuneList</code> can be used to customize the
call to each component model and will be discussed in more detail later.
First, lets build an example dataset (adapted from the caret
vignette):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Sonar</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">107L</span><span class="op">)</span></span>
<span><span class="va">inTrain</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">createDataPartition</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Sonar</span><span class="op">$</span><span class="va">Class</span>, p <span class="op">=</span> <span class="fl">0.75</span>, list <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">training</span> <span class="op">&lt;-</span> <span class="va">Sonar</span><span class="op">[</span><span class="va">inTrain</span>, <span class="op">]</span></span>
<span><span class="va">testing</span> <span class="op">&lt;-</span> <span class="va">Sonar</span><span class="op">[</span><span class="op">-</span><span class="va">inTrain</span>, <span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretList.html">caretList</a></span><span class="op">(</span></span>
<span>  <span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">training</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glmnet"</span>, <span class="st">"rpart"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: glmnet, rpart  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name metric     value         sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt; &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     glmnet    ROC 0.8599370 0.09069233</span></span>
<span><span class="co">#&gt; 2:      rpart    ROC 0.7495693 0.10710959</span></span></code></pre></div>
<p>(As with <code>train</code>, the formula interface is convenient but
introduces move overhead. For large datasets the explicitly passing
<code>x</code> and <code>y</code> is preferred). We can use the
<code>predict</code> function to extract predictions from this object
for new data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_list</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">testing</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">p</span>, format <span class="op">=</span> <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">glmnet</th>
<th align="right">rpart</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.9398307</td>
<td align="right">0.1250000</td>
</tr>
<tr class="even">
<td align="right">0.1428399</td>
<td align="right">0.1250000</td>
</tr>
<tr class="odd">
<td align="right">0.2041884</td>
<td align="right">0.8181818</td>
</tr>
<tr class="even">
<td align="right">0.5180661</td>
<td align="right">0.8181818</td>
</tr>
<tr class="odd">
<td align="right">0.5951758</td>
<td align="right">0.8181818</td>
</tr>
<tr class="even">
<td align="right">0.5055788</td>
<td align="right">0.8181818</td>
</tr>
</tbody>
</table>
<p>If you desire more control over the model fit, use the
<code>caretModelSpec</code> to construct a list of model specifications
for the <code>tuneList</code> argument. This argument can be used to fit
several different variants of the same model, and can also be used to
pass arguments through <code>train</code> down to the component
functions (e.g. <code>trace=FALSE</code> for <code>nnet</code>):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_list_big</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretList.html">caretList</a></span><span class="op">(</span></span>
<span>  <span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">training</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glmnet"</span>, <span class="st">"rpart"</span><span class="op">)</span>,</span>
<span>  tuneList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    rf1 <span class="op">=</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretModelSpec.html">caretModelSpec</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rf"</span>, tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>.mtry <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    rf2 <span class="op">=</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretModelSpec.html">caretModelSpec</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"rf"</span>, tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>.mtry <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span>, preProcess <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span>,</span>
<span>    nn <span class="op">=</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretModelSpec.html">caretModelSpec</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"nnet"</span>, tuneLength <span class="op">=</span> <span class="fl">2L</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_list_big</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rf1, rf2, nn, glmnet, rpart  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name metric     value         sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt; &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:         rf    ROC 0.9233333 0.03092727</span></span>
<span><span class="co">#&gt; 2:         rf    ROC 0.8573319 0.06415653</span></span>
<span><span class="co">#&gt; 3:       nnet    ROC 0.8746849 0.04153548</span></span>
<span><span class="co">#&gt; 4:     glmnet    ROC 0.8589216 0.03577354</span></span>
<span><span class="co">#&gt; 5:      rpart    ROC 0.7144048 0.12164189</span></span></code></pre></div>
<p>Finally, you should note that <code>caretList</code> does not support
custom caret models. Fitting those models are beyond the scope of this
vignette, but if you do so, you can manually add them to the model list
(e.g. <code>model_list_big[["my_custom_model"]] &lt;- my_custom_model</code>).
Just be sure to use the same re-sampling indexes in
<code>trControl</code> as you use in the <code>caretList</code>
models!</p>
</div>
<div class="section level2">
<h2 id="caretensemble">caretEnsemble<a class="anchor" aria-label="anchor" href="#caretensemble"></a>
</h2>
<p><code>caretList</code> is the preferred way to construct list of
caret models in this package, as it will ensure the resampling indexes
are identical across all models. Lets take a closer look at our list of
models:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lattice</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html" class="external-link">resamples</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="caretEnsemble-intro_files/figure-html/unnamed-chunk-6-1.png" alt="X/Y scatter plot of rpart vs glmnet AUCs on the Sonar dataset. The glmnet model is better for 4 out of 5 resamples." width="700"></p>
<p>As you can see from this plot, these 2 models are uncorrelated, and
the rpart model is occasionally anti-predictive, with a one re-sample
showing AUC of 0.46.</p>
<p>We can confirm the 2 model”s correlation with the
<code>modelCor</code> function from caret (caret has a lot of convenient
functions for analyzing lists of models):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html" class="external-link">modelCor</a></span><span class="op">(</span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html" class="external-link">resamples</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           glmnet     rpart</span></span>
<span><span class="co">#&gt; glmnet 1.0000000 0.5172171</span></span>
<span><span class="co">#&gt; rpart  0.5172171 1.0000000</span></span></code></pre></div>
<p>These 2 models make a good candidate for an ensemble: their
predictions are fairly uncorrelated, but their overall accuracy is
similar. We do a simple, linear greedy optimization on AUC using
caretEnsemble:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">greedy_ensemble</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">greedy_ensemble</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: glmnet, rpart  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Importance:</span></span>
<span><span class="co">#&gt; glmnet_M glmnet_R  rpart_M  rpart_R </span></span>
<span><span class="co">#&gt;   0.3533   0.3942   0.1271   0.1254 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name metric     value         sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt; &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   ensemble    ROC 0.8788866 0.05319158</span></span>
<span><span class="co">#&gt; 2:     glmnet    ROC 0.8599370 0.09069233</span></span>
<span><span class="co">#&gt; 3:      rpart    ROC 0.7495693 0.10710959</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_list</span>, newdata <span class="op">=</span> <span class="va">testing</span>, excluded_class_id <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="va">ens_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">greedy_ensemble</span>, newdata <span class="op">=</span> <span class="va">testing</span>, excluded_class_id <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="va">model_preds</span><span class="op">$</span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="va">ens_preds</span></span>
<span><span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu">caTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caTools/man/colAUC.html" class="external-link">colAUC</a></span><span class="op">(</span><span class="va">model_preds</span>, <span class="va">testing</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">auc</span><span class="op">)</span></span>
<span><span class="co">#&gt;            glmnet     rpart  ensemble</span></span>
<span><span class="co">#&gt; M vs. R 0.8472222 0.7746914 0.8657407</span></span></code></pre></div>
<p>The ensemble has an AUC on the training set resamples of 0.87 which
is about 1.9% better than the best individual model.</p>
<p>Note that the levels for the Sonar Data are “M” and “R”, where M is
level 1 and R is level 2. “M” stands for “metal cylinder” and “R” stands
for rock. M is the positive class, so we exclude class 2L from our
predictions. You can set excluded_class_id = 0L</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">greedy_ensemble</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">testing</span><span class="op">)</span>, excluded_class_id <span class="op">=</span> <span class="fl">0L</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">p</span>, format <span class="op">=</span> <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">M</th>
<th align="right">R</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.2801736</td>
<td align="right">0.7198264</td>
</tr>
<tr class="even">
<td align="right">0.8619769</td>
<td align="right">0.1380231</td>
</tr>
<tr class="odd">
<td align="right">0.6300334</td>
<td align="right">0.3699666</td>
</tr>
<tr class="even">
<td align="right">0.4009026</td>
<td align="right">0.5990974</td>
</tr>
<tr class="odd">
<td align="right">0.3446125</td>
<td align="right">0.6553875</td>
</tr>
<tr class="even">
<td align="right">0.4100184</td>
<td align="right">0.5899816</td>
</tr>
</tbody>
</table>
<p>We can also use varImp to extract the variable importances from each
member of the ensemble, as well as the final ensemble model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">varImp</a></span><span class="op">(</span><span class="va">greedy_ensemble</span><span class="op">)</span>, <span class="fl">4L</span><span class="op">)</span></span>
<span><span class="co">#&gt; glmnet_M glmnet_R  rpart_M  rpart_R </span></span>
<span><span class="co">#&gt;   0.3331   0.3802   0.1441   0.1426</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="caretstack">caretStack<a class="anchor" aria-label="anchor" href="#caretstack"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_ensemble</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretStack.html">caretStack</a></span><span class="op">(</span><span class="va">model_list</span>, method <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span></span>
<span><span class="va">model_preds2</span> <span class="op">&lt;-</span> <span class="va">model_preds</span></span>
<span><span class="va">model_preds2</span><span class="op">$</span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">glm_ensemble</span>, newdata <span class="op">=</span> <span class="va">testing</span>, excluded_class_id <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">caTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caTools/man/colAUC.html" class="external-link">colAUC</a></span><span class="op">(</span><span class="va">model_preds2</span>, <span class="va">testing</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;            glmnet     rpart ensemble</span></span>
<span><span class="co">#&gt; M vs. R 0.8472222 0.7746914 0.867284</span></span>
<span><span class="va">CF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_ensemble</span><span class="op">$</span><span class="va">ens_model</span><span class="op">$</span><span class="va">finalModel</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">CF</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">CF</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    glmnet     rpart </span></span>
<span><span class="co">#&gt; 0.7154119 0.2845881</span></span></code></pre></div>
<p>Note that <code>glm_ensemble$ens_model</code> is a regular caret
object of class <code>train</code>. The glm-weighted model weights (glm
vs rpart) and test-set AUCs are extremely similar to the caretEnsemble
greedy optimization.</p>
<p>We can also use more sophisticated ensembles than simple linear
weights, but these models are much more susceptible to over-fitting, and
generally require large sets of resamples to train on (n=50 or higher
for bootstrap samples). Lets try one anyways:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbm_ensemble</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretStack.html">caretStack</a></span><span class="op">(</span></span>
<span>  <span class="va">model_list</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"gbm"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tuneLength <span class="op">=</span> <span class="fl">5L</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model_preds3</span> <span class="op">&lt;-</span> <span class="va">model_preds</span></span>
<span><span class="va">model_preds3</span><span class="op">$</span><span class="va">ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gbm_ensemble</span>, newdata <span class="op">=</span> <span class="va">testing</span>, excluded_class_id <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span></span>
<span><span class="fu">caTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caTools/man/colAUC.html" class="external-link">colAUC</a></span><span class="op">(</span><span class="va">model_preds3</span>, <span class="va">testing</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></span>
<span><span class="co">#&gt;            glmnet     rpart  ensemble</span></span>
<span><span class="co">#&gt; M vs. R 0.8472222 0.7746914 0.8657407</span></span></code></pre></div>
<p>In this case, the sophisticated ensemble is no better than a simple
weighted linear combination. Non-linear ensembles seem to work best when
you have:</p>
<ol style="list-style-type: decimal">
<li>Lots of data.</li>
<li>Lots of models with similar accuracy.</li>
<li>Your models are uncorrelated: each one seems to capture a different
aspect of the data, and different models perform best on different
subsets of the data.</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary A. Deane-Mayer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
