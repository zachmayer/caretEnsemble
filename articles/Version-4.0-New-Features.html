<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Version 4.0 New Features • caretEnsemble</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Version 4.0 New Features">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">caretEnsemble</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/caretEnsemble-intro.html">A Brief Introduction to caretEnsemble</a></li>
    <li><a class="dropdown-item" href="../articles/Version-4.0-New-Features.html">Version 4.0 New Features</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/zachmayer/caretEnsemble/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Version 4.0 New Features</h1>
                        <h4 data-toc-skip class="author">Zach
Deane-Mayer</h4>
            
            <h4 data-toc-skip class="date">2024-08-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/zachmayer/caretEnsemble/blob/main/vignettes/Version-4.0-New-Features.Rmd" class="external-link"><code>vignettes/Version-4.0-New-Features.Rmd</code></a></small>
      <div class="d-none name"><code>Version-4.0-New-Features.Rmd</code></div>
    </div>

    
    
<p>caretEnsemble 4.0.0 introduces many new features! Let’s quickly go
over them.</p>
<div class="section level2">
<h2 id="multiclass-support">Multiclass support<a class="anchor" aria-label="anchor" href="#multiclass-support"></a>
</h2>
<p>caretEnsemble now fully supports multiclass problems:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretList.html">caretList</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">4L</span><span class="op">]</span>,</span>
<span>  y <span class="op">=</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">5L</span><span class="op">]</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rpart"</span>, <span class="st">"rf"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rpart, rf  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name   metric     value         sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt;   &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      rpart Accuracy 0.9333333 0.04082483</span></span>
<span><span class="co">#&gt; 2:         rf Accuracy 0.9600000 0.02788867</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="greedy-optimizer-in-caretensemble">Greedy Optimizer in caretEnsemble<a class="anchor" aria-label="anchor" href="#greedy-optimizer-in-caretensemble"></a>
</h2>
<p>The new version uses a greedy optimizer by default, ensuring the
ensemble is never worse than the worst single model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ens</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span><span class="va">model_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rpart, rf  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Importance:</span></span>
<span><span class="co">#&gt;     rpart_setosa rpart_versicolor  rpart_virginica        rf_setosa </span></span>
<span><span class="co">#&gt;           0.2937           0.0101           0.0122           0.0000 </span></span>
<span><span class="co">#&gt;    rf_versicolor     rf_virginica </span></span>
<span><span class="co">#&gt;           0.3303           0.3537 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name   metric     value         sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt;   &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   ensemble Accuracy 0.9600000 0.01490712</span></span>
<span><span class="co">#&gt; 2:      rpart Accuracy 0.9333333 0.04082483</span></span>
<span><span class="co">#&gt; 3:         rf Accuracy 0.9600000 0.02788867</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="enhanced-s3-methods">Enhanced S3 Methods<a class="anchor" aria-label="anchor" href="#enhanced-s3-methods"></a>
</h2>
<p>caretStack (and by extension, caretEnsemble) now supports various S3
methods:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rpart, rf  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; caret::train model:</span></span>
<span><span class="co">#&gt; Greedy Mean Squared Error Optimizer </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 120, 120, 120, 120, 120 </span></span>
<span><span class="co">#&gt; Resampling results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Accuracy  Kappa</span></span>
<span><span class="co">#&gt;   0.96      0.94 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tuning parameter 'max_iter' was held constant at a value of 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final model:</span></span>
<span><span class="co">#&gt; Greedy MSE</span></span>
<span><span class="co">#&gt; RMSE:  0.1476488 </span></span>
<span><span class="co">#&gt; Weights:</span></span>
<span><span class="co">#&gt;                  setosa versicolor virginica</span></span>
<span><span class="co">#&gt; rpart_setosa          1       0.00      0.00</span></span>
<span><span class="co">#&gt; rpart_versicolor      0       0.00      0.03</span></span>
<span><span class="co">#&gt; rpart_virginica       0       0.03      0.00</span></span>
<span><span class="co">#&gt; rf_setosa             0       0.00      0.00</span></span>
<span><span class="co">#&gt; rf_versicolor         0       0.97      0.00</span></span>
<span><span class="co">#&gt; rf_virginica          0       0.00      0.97</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rpart, rf  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model Importance:</span></span>
<span><span class="co">#&gt;     rpart_setosa rpart_versicolor  rpart_virginica        rf_setosa </span></span>
<span><span class="co">#&gt;           0.2579           0.0113           0.0113           0.0000 </span></span>
<span><span class="co">#&gt;    rf_versicolor     rf_virginica </span></span>
<span><span class="co">#&gt;           0.3490           0.3705 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model accuracy:</span></span>
<span><span class="co">#&gt;    model_name   metric     value         sd</span></span>
<span><span class="co">#&gt;        &lt;char&gt;   &lt;char&gt;     &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:   ensemble Accuracy 0.9600000 0.01490712</span></span>
<span><span class="co">#&gt; 2:      rpart Accuracy 0.9333333 0.04082483</span></span>
<span><span class="co">#&gt; 3:         rf Accuracy 0.9600000 0.02788867</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span></span></code></pre></div>
<p><img src="Version-4.0-New-Features_files/figure-html/unnamed-chunk-5-1.png" alt="A dot and whisker plot of ROC for glmnet, rpart, and an ensemble. The ensemble has the highest ROC and is slighly better than the glmnet. The rpart model is bad." width="700"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span></span></code></pre></div>
<p><img src="Version-4.0-New-Features_files/figure-html/unnamed-chunk-6-1.png" alt="A 4-panel plot for glmnet, rpart, and an ensemble. The ensemble has the highest ROC and is slighly better than the glmnet. The rpart model is bad. The glmnet has the highest weight, and the residuals look biased." width="700"></p>
</div>
<div class="section level2">
<h2 id="improved-default-traincontrol">Improved Default trainControl<a class="anchor" aria-label="anchor" href="#improved-default-traincontrol"></a>
</h2>
<p>A new default trainControl constructor makes it easier to build
appropriate controls for caretLists. These controls include explicit
indexes based on the target, return stacked predictions, and use
probability estimates for classification models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">class_control</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">class_control</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "adaptive"          "allowParallel"     "classProbs"       </span></span>
<span><span class="co">#&gt;  [4] "fixedWindow"       "horizon"           "index"            </span></span>
<span><span class="co">#&gt;  [7] "indexFinal"        "indexOut"          "initialWindow"    </span></span>
<span><span class="co">#&gt; [10] "method"            "number"            "p"                </span></span>
<span><span class="co">#&gt; [13] "predictionBounds"  "preProcOptions"    "repeats"          </span></span>
<span><span class="co">#&gt; [16] "returnData"        "returnResamp"      "sampling"         </span></span>
<span><span class="co">#&gt; [19] "savePredictions"   "search"            "seeds"            </span></span>
<span><span class="co">#&gt; [22] "selectionFunction" "skip"              "summaryFunction"  </span></span>
<span><span class="co">#&gt; [25] "timingSamps"       "trim"              "verboseIter"</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg_control</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">reg_control</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "adaptive"          "allowParallel"     "classProbs"       </span></span>
<span><span class="co">#&gt;  [4] "fixedWindow"       "horizon"           "index"            </span></span>
<span><span class="co">#&gt;  [7] "indexFinal"        "indexOut"          "initialWindow"    </span></span>
<span><span class="co">#&gt; [10] "method"            "number"            "p"                </span></span>
<span><span class="co">#&gt; [13] "predictionBounds"  "preProcOptions"    "repeats"          </span></span>
<span><span class="co">#&gt; [16] "returnData"        "returnResamp"      "sampling"         </span></span>
<span><span class="co">#&gt; [19] "savePredictions"   "search"            "seeds"            </span></span>
<span><span class="co">#&gt; [22] "selectionFunction" "skip"              "summaryFunction"  </span></span>
<span><span class="co">#&gt; [25] "timingSamps"       "trim"              "verboseIter"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mixed-resampling-strategies">Mixed Resampling Strategies<a class="anchor" aria-label="anchor" href="#mixed-resampling-strategies"></a>
</h2>
<p>Models with different resampling strategies can now be ensembled:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">2L</span><span class="op">:</span><span class="fl">3L</span><span class="op">]</span></span>
<span><span class="va">flex_list</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretList.html">caretList</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rpart"</span>, <span class="st">"rf"</span><span class="op">)</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="va">y</span>, number <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; note: only 1 unique complexity parameters in default grid. Truncating the grid to 1 .</span></span>
<span></span>
<span><span class="va">flex_list</span><span class="op">$</span><span class="va">glm_boot</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="va">y</span>, method <span class="op">=</span> <span class="st">"boot"</span>, number <span class="op">=</span> <span class="fl">25L</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">flex_ens</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span><span class="va">flex_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">flex_ens</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rpart, rf, glm_boot  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; caret::train model:</span></span>
<span><span class="co">#&gt; Greedy Mean Squared Error Optimizer </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 120, 121, 120, 119, 120 </span></span>
<span><span class="co">#&gt; Resampling results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   RMSE       Rsquared   MAE      </span></span>
<span><span class="co">#&gt;   0.3213821  0.8504616  0.2652383</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tuning parameter 'max_iter' was held constant at a value of 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final model:</span></span>
<span><span class="co">#&gt; Greedy MSE</span></span>
<span><span class="co">#&gt; RMSE:  0.3204963 </span></span>
<span><span class="co">#&gt; Weights:</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; rpart    0.00</span></span>
<span><span class="co">#&gt; rf       0.51</span></span>
<span><span class="co">#&gt; glm_boot 0.49</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="mixed-model-types">Mixed Model Types<a class="anchor" aria-label="anchor" href="#mixed-model-types"></a>
</h2>
<p>caretEnsemble now allows ensembling of mixed lists of classification
and regression models:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">4L</span><span class="op">]</span></span>
<span></span>
<span><span class="va">target_class</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span>, <span class="fl">5L</span><span class="op">]</span></span>
<span><span class="va">target_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">5L</span><span class="op">]</span> <span class="op">==</span> <span class="st">"virginica"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ctrl_class</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="va">target_class</span><span class="op">)</span></span>
<span><span class="va">ctrl_reg</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/defaultControl.html">defaultControl</a></span><span class="op">(</span><span class="va">target_reg</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_class</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">4L</span><span class="op">]</span>, <span class="va">target_class</span>, method <span class="op">=</span> <span class="st">"rf"</span>, trControl <span class="op">=</span> <span class="va">ctrl_class</span><span class="op">)</span></span>
<span><span class="va">model_reg</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">4L</span><span class="op">]</span>, <span class="va">target_reg</span>, method <span class="op">=</span> <span class="st">"rf"</span>, trControl <span class="op">=</span> <span class="va">ctrl_reg</span><span class="op">)</span></span>
<span><span class="va">mixed_list</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/as.caretList.html">as.caretList</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="va">model_class</span>, reg <span class="op">=</span> <span class="va">model_reg</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mixed_ens</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span><span class="va">mixed_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mixed_ens</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: class, reg  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; caret::train model:</span></span>
<span><span class="co">#&gt; Greedy Mean Squared Error Optimizer </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 120, 120, 120, 120, 120 </span></span>
<span><span class="co">#&gt; Resampling results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Accuracy   Kappa</span></span>
<span><span class="co">#&gt;   0.9466667  0.92 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tuning parameter 'max_iter' was held constant at a value of 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final model:</span></span>
<span><span class="co">#&gt; Greedy MSE</span></span>
<span><span class="co">#&gt; RMSE:  0.1520195 </span></span>
<span><span class="co">#&gt; Weights:</span></span>
<span><span class="co">#&gt;                  setosa versicolor virginica</span></span>
<span><span class="co">#&gt; class_setosa          1       0.01      0.00</span></span>
<span><span class="co">#&gt; class_versicolor      0       0.97      0.01</span></span>
<span><span class="co">#&gt; class_virginica       0       0.02      0.00</span></span>
<span><span class="co">#&gt; reg                   0       0.00      0.99</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="transfer-learning">Transfer Learning<a class="anchor" aria-label="anchor" href="#transfer-learning"></a>
</h2>
<p>caretStack now supports transfer learning for ensembling models
trained on different datasets:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>, <span class="fl">100L</span><span class="op">)</span></span>
<span><span class="va">train_data</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span><span class="va">new_data</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="op">-</span><span class="va">train_idx</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">model_list</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretList.html">caretList</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">train_data</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">4L</span><span class="op">]</span>,</span>
<span>  y <span class="op">=</span> <span class="va">train_data</span><span class="op">[</span>, <span class="fl">5L</span><span class="op">]</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rpart"</span>, <span class="st">"rf"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">transfer_ens</span> <span class="op">&lt;-</span> <span class="fu">caretEnsemble</span><span class="fu">::</span><span class="fu"><a href="../reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span></span>
<span>  <span class="va">model_list</span>,</span>
<span>  new_X <span class="op">=</span> <span class="va">new_data</span><span class="op">[</span>, <span class="fl">1L</span><span class="op">:</span><span class="fl">4L</span><span class="op">]</span>,</span>
<span>  new_y <span class="op">=</span> <span class="va">new_data</span><span class="op">[</span>, <span class="fl">5L</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">transfer_ens</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following models were ensembled: rpart, rf  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; caret::train model:</span></span>
<span><span class="co">#&gt; Greedy Mean Squared Error Optimizer </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; No pre-processing</span></span>
<span><span class="co">#&gt; Resampling: Cross-Validated (5 fold) </span></span>
<span><span class="co">#&gt; Summary of sample sizes: 39, 41, 40, 40, 40 </span></span>
<span><span class="co">#&gt; Resampling results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Accuracy  Kappa    </span></span>
<span><span class="co">#&gt;   0.96      0.9398462</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Tuning parameter 'max_iter' was held constant at a value of 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final model:</span></span>
<span><span class="co">#&gt; Greedy MSE</span></span>
<span><span class="co">#&gt; RMSE:  0.1090264 </span></span>
<span><span class="co">#&gt; Weights:</span></span>
<span><span class="co">#&gt;                  setosa versicolor virginica</span></span>
<span><span class="co">#&gt; rpart_setosa          1       0.00         0</span></span>
<span><span class="co">#&gt; rpart_versicolor      0       0.00         0</span></span>
<span><span class="co">#&gt; rpart_virginica       0       0.00         0</span></span>
<span><span class="co">#&gt; rf_setosa             0       0.01         0</span></span>
<span><span class="co">#&gt; rf_versicolor         0       0.99         0</span></span>
<span><span class="co">#&gt; rf_virginica          0       0.00         1</span></span></code></pre></div>
<p>We can also predict on new data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">transfer_ens</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">preds</span>, format <span class="op">=</span> <span class="st">"markdown"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">setosa</th>
<th align="right">versicolor</th>
<th align="right">virginica</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.9900990</td>
<td align="right">0.0099010</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.9900990</td>
<td align="right">0.0099010</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.9900990</td>
<td align="right">0.0099010</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.9881814</td>
<td align="right">0.0118186</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">0.9900990</td>
<td align="right">0.0099010</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">0.9900990</td>
<td align="right">0.0099010</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="permutation-importance">Permutation Importance<a class="anchor" aria-label="anchor" href="#permutation-importance"></a>
</h2>
<p>Permutation importance is now the default method for variable
importance in caretLists and caretStacks:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">importance</span> <span class="op">&lt;-</span> <span class="fu">caret</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html" class="external-link">varImp</a></span><span class="op">(</span><span class="va">transfer_ens</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">importance</span>, <span class="fl">2L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;     rpart_setosa rpart_versicolor  rpart_virginica        rf_setosa </span></span>
<span><span class="co">#&gt;             0.36             0.00             0.00             0.00 </span></span>
<span><span class="co">#&gt;    rf_versicolor     rf_virginica </span></span>
<span><span class="co">#&gt;             0.32             0.31</span></span></code></pre></div>
<p>Note that the ensemble uses rpart to classify the easy class (setosa)
and then uses the rf to distinguish between the 2 more difficult
classes.</p>
<p>This completes our demonstration of the key new features in
caretEnsemble 4.0. These enhancements provide greater flexibility,
improved performance, and easier usage for ensemble modeling in R.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zachary A. Deane-Mayer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
