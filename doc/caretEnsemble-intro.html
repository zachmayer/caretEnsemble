<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Zach Mayer" />

<meta name="date" content="2023-02-08" />

<title>A Brief Introduction to caretEnsemble</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">A Brief Introduction to caretEnsemble</h1>
<h4 class="author">Zach Mayer</h4>
<h4 class="date">2023-02-08</h4>



<p><code>caretEnsemble</code> is a package for making ensembles of caret
models. You should already be somewhat familiar with the caret package
before trying out <code>caretEnsemble</code>.</p>
<p><code>caretEnsemble</code> has 3 primary functions:
<strong><code>caretList</code></strong>,
<strong><code>caretEnsemble</code></strong> and
<strong><code>caretStack</code></strong>. <code>caretList</code> is used
to build lists of caret models on the same training data, with the same
re-sampling parameters. <code>caretEnsemble</code> and
<code>caretStack</code> are used to create ensemble models from such
lists of caret models. <code>caretEnsemble</code> uses a glm to create a
simple linear blend of models and <code>caretStack</code> uses a caret
model to combine the outputs from several component caret models.</p>
<div id="caretlist" class="section level2">
<h2>caretList</h2>
<p><code>caretList</code> is a flexible function for fitting many
different caret models, with the same resampling parameters, to the same
dataset. It returns a convenient <code>list</code> of caret objects
which can later be passed to <code>caretEnsemble</code> and
<code>caretStack</code>. <code>caretList</code> has almost exactly the
same arguments as <code>train</code> (from the caret package), with the
exception that the <code>trControl</code> argument comes last. It can
handle both the formula interface and the explicit <code>x</code>,
<code>y</code> interface to train. As in caret, the formula interface
introduces some overhead and the <code>x</code>, <code>y</code>
interface is preferred.</p>
<p><code>caretEnsemble</code> has 2 arguments that can be used to
specify which models to fit: <code>methodList</code> and
<code>tuneList</code>. <code>methodList</code> is a simple character
vector of methods that will be fit with the default <code>train</code>
parameters, while <code>tuneList</code> can be used to customize the
call to each component model and will be discussed in more detail later.
First, lets build an example dataset (adapted from the caret
vignette):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Adapted from the caret vignette</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;caret&quot;</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;mlbench&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;pROC&quot;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Sonar)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">107</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>inTrain <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(<span class="at">y =</span> Sonar<span class="sc">$</span>Class, <span class="at">p =</span> .<span class="dv">75</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> Sonar[ inTrain,]</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">&lt;-</span> Sonar[<span class="sc">-</span>inTrain,]</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>my_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">&quot;boot&quot;</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">number=</span><span class="dv">25</span>,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">savePredictions=</span><span class="st">&quot;final&quot;</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">classProbs=</span><span class="cn">TRUE</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">index=</span><span class="fu">createResample</span>(training<span class="sc">$</span>Class, <span class="dv">25</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">summaryFunction=</span>twoClassSummary</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Notice that we are explicitly setting the resampling
<code>index</code> to being used in <code>trainControl</code>. If you do
not set this index manually, <code>caretList</code> will attempt to set
it for automatically, but it”s generally a good idea to set it
yourself.</p>
<p>Now we can use <code>caretList</code> to fit a series of models (each
with the same <code>trControl</code>):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;rpart&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;caretEnsemble&quot;</span>)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;caretEnsemble&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     autoplot</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model_list <span class="ot">&lt;-</span> <span class="fu">caretList</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  Class<span class="sc">~</span>., <span class="at">data=</span>training,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl=</span>my_control,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">methodList=</span><span class="fu">c</span>(<span class="st">&quot;glm&quot;</span>, <span class="st">&quot;rpart&quot;</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>(As with <code>train</code>, the formula interface is convenient but
introduces move overhead. For large datasets the explicitly passing
<code>x</code> and <code>y</code> is preferred). We can use the
<code>predict</code> function to extract predictions from this object
for new data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(model_list, <span class="at">newdata=</span><span class="fu">head</span>(testing)))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">glm</th>
<th align="right">rpart</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.00e+00</td>
<td align="right">0.8750000</td>
</tr>
<tr class="even">
<td align="right">1.00e+00</td>
<td align="right">0.8750000</td>
</tr>
<tr class="odd">
<td align="right">1.00e+00</td>
<td align="right">0.1818182</td>
</tr>
<tr class="even">
<td align="right">2.35e-05</td>
<td align="right">0.1818182</td>
</tr>
<tr class="odd">
<td align="right">0.00e+00</td>
<td align="right">0.1818182</td>
</tr>
<tr class="even">
<td align="right">1.00e+00</td>
<td align="right">0.1818182</td>
</tr>
</tbody>
</table>
<p>If you desire more control over the model fit, use the
<code>caretModelSpec</code> to construct a list of model specifications
for the <code>tuneList</code> argument. This argument can be used to fit
several different variants of the same model, and can also be used to
pass arguments through <code>train</code> down to the component
functions (e.g. <code>trace=FALSE</code> for <code>nnet</code>):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;mlbench&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;randomForest&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;nnet&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>model_list_big <span class="ot">&lt;-</span> <span class="fu">caretList</span>(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  Class<span class="sc">~</span>., <span class="at">data=</span>training,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl=</span>my_control,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric=</span><span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">methodList=</span><span class="fu">c</span>(<span class="st">&quot;glm&quot;</span>, <span class="st">&quot;rpart&quot;</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneList=</span><span class="fu">list</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rf1=</span><span class="fu">caretModelSpec</span>(<span class="at">method=</span><span class="st">&quot;rf&quot;</span>, <span class="at">tuneGrid=</span><span class="fu">data.frame</span>(<span class="at">.mtry=</span><span class="dv">2</span>)),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rf2=</span><span class="fu">caretModelSpec</span>(<span class="at">method=</span><span class="st">&quot;rf&quot;</span>, <span class="at">tuneGrid=</span><span class="fu">data.frame</span>(<span class="at">.mtry=</span><span class="dv">10</span>), <span class="at">preProcess=</span><span class="st">&quot;pca&quot;</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nn=</span><span class="fu">caretModelSpec</span>(<span class="at">method=</span><span class="st">&quot;nnet&quot;</span>, <span class="at">tuneLength=</span><span class="dv">2</span>, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Finally, you should note that <code>caretList</code> does not support
custom caret models. Fitting those models are beyond the scope of this
vignette, but if you do so, you can manually add them to the model list
(e.g. <code>model_list_big[[&quot;my_custom_model&quot;]] &lt;- my_custom_model</code>).
Just be sure to use the same re-sampling indexes in
<code>trControl</code> as you use in the <code>caretList</code>
models!</p>
</div>
<div id="caretensemble" class="section level2">
<h2>caretEnsemble</h2>
<p><code>caretList</code> is the preferred way to construct list of
caret models in this package, as it will ensure the resampling indexes
are identical across all models. Lets take a closer look at our list of
models:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyplot</span>(<span class="fu">resamples</span>(model_list))</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>As you can see from this plot, these 2 models are un-correlated, and
the rpart model is occasionally anti-predictive, with a few re-samples
showing AUCS around 0.3 to 0.4.</p>
<p>We can confirm the 2 model”s correlation with the
<code>modelCor</code> function from caret (caret has a lot of convenient
functions for analyzing lists of models):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelCor</span>(<span class="fu">resamples</span>(model_list))</span></code></pre></div>
<pre><code>##               glm       rpart
## glm    1.00000000 -0.01658742
## rpart -0.01658742  1.00000000</code></pre>
<p>These 2 models make a good candidate for an ensemble: their
predictions are fairly un-correlated, but their overall accuracy is
similar. We do a simple, linear greedy optimization on AUC using
caretEnsemble:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>greedy_ensemble <span class="ot">&lt;-</span> <span class="fu">caretEnsemble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  model_list, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric=</span><span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl=</span><span class="fu">trainControl</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">number=</span><span class="dv">2</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">summaryFunction=</span>twoClassSummary,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">classProbs=</span><span class="cn">TRUE</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(greedy_ensemble)</span></code></pre></div>
<pre><code>## The following models were ensembled: glm, rpart 
## They were weighted: 
## 1.3764 -1.0734 -1.8211
## The resulting ROC is: 0.7379
## The fit for each individual model on the ROC is: 
##  method       ROC      ROCSD
##     glm 0.6884429 0.08365065
##   rpart 0.7013261 0.05304238</code></pre>
<p>The ensemble”s AUC on the training set resamples is 0.76, which is
about 7% better than the best individual model. We can confirm this
finding on the test set:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;caTools&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>model_preds <span class="ot">&lt;-</span> <span class="fu">lapply</span>(model_list, predict, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>model_preds <span class="ot">&lt;-</span> <span class="fu">lapply</span>(model_preds, <span class="cf">function</span>(x) x[,<span class="st">&quot;M&quot;</span>])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>model_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(model_preds)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>ens_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(greedy_ensemble, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>model_preds<span class="sc">$</span>ensemble <span class="ot">&lt;-</span> ens_preds</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>caTools<span class="sc">::</span><span class="fu">colAUC</span>(model_preds, testing<span class="sc">$</span>Class)</span></code></pre></div>
<pre><code>##               glm     rpart  ensemble
## M vs. R 0.7137346 0.7746914 0.8140432</code></pre>
<p>The ensemble”s AUC on the test set is about 6% higher than the best
individual model.</p>
<p>We can also use varImp to extract the variable importances from each
member of the ensemble, as well as the final ensemble model:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">varImp</span>(greedy_ensemble)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">overall</th>
<th align="right">glm</th>
<th align="right">rpart</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">V4</td>
<td align="right">0.0000000</td>
<td align="right">0.0000000</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V59</td>
<td align="right">0.0289819</td>
<td align="right">0.0781531</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V41</td>
<td align="right">0.0770670</td>
<td align="right">0.2078205</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V53</td>
<td align="right">0.0913891</td>
<td align="right">0.2464417</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V56</td>
<td align="right">0.1204130</td>
<td align="right">0.3247080</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V38</td>
<td align="right">0.1247390</td>
<td align="right">0.3363738</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V8</td>
<td align="right">0.1311981</td>
<td align="right">0.3537914</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V19</td>
<td align="right">0.1328616</td>
<td align="right">0.3582773</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V47</td>
<td align="right">0.1394219</td>
<td align="right">0.3759677</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V55</td>
<td align="right">0.1589879</td>
<td align="right">0.4287299</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V26</td>
<td align="right">0.1765625</td>
<td align="right">0.4761218</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V48</td>
<td align="right">0.1779364</td>
<td align="right">0.4798269</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V29</td>
<td align="right">0.2160511</td>
<td align="right">0.5826078</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V42</td>
<td align="right">0.2333095</td>
<td align="right">0.6291469</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V6</td>
<td align="right">0.2343866</td>
<td align="right">0.6320516</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V20</td>
<td align="right">0.2397789</td>
<td align="right">0.6465924</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V1</td>
<td align="right">0.2593621</td>
<td align="right">0.6994010</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V2</td>
<td align="right">0.2652978</td>
<td align="right">0.7154073</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V54</td>
<td align="right">0.3097143</td>
<td align="right">0.8351818</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V40</td>
<td align="right">0.3216242</td>
<td align="right">0.8672981</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V60</td>
<td align="right">0.3563664</td>
<td align="right">0.9609847</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V14</td>
<td align="right">0.3572180</td>
<td align="right">0.9632810</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V3</td>
<td align="right">0.3595286</td>
<td align="right">0.9695119</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V52</td>
<td align="right">0.3948310</td>
<td align="right">1.0647091</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V58</td>
<td align="right">0.4186773</td>
<td align="right">1.1290135</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V35</td>
<td align="right">0.4268529</td>
<td align="right">1.1510598</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V15</td>
<td align="right">0.4676095</td>
<td align="right">1.2609650</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V51</td>
<td align="right">0.5138987</td>
<td align="right">1.3857892</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V21</td>
<td align="right">0.5196423</td>
<td align="right">1.4012777</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V57</td>
<td align="right">0.5348672</td>
<td align="right">1.4423335</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V18</td>
<td align="right">0.5821234</td>
<td align="right">1.5697653</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V34</td>
<td align="right">0.5993462</td>
<td align="right">1.6162087</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V49</td>
<td align="right">0.7437472</td>
<td align="right">2.0056034</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V5</td>
<td align="right">0.8256171</td>
<td align="right">2.2263753</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V33</td>
<td align="right">0.9981225</td>
<td align="right">2.6915566</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V50</td>
<td align="right">1.0826702</td>
<td align="right">2.9195497</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V43</td>
<td align="right">1.2909897</td>
<td align="right">3.4813082</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V30</td>
<td align="right">1.3041581</td>
<td align="right">3.5168184</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V23</td>
<td align="right">1.3214433</td>
<td align="right">3.5634300</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V22</td>
<td align="right">1.3849784</td>
<td align="right">3.7347601</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V28</td>
<td align="right">1.6013217</td>
<td align="right">4.3181557</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V24</td>
<td align="right">1.8528812</td>
<td align="right">4.9965160</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V25</td>
<td align="right">2.0614003</td>
<td align="right">5.5588126</td>
<td align="right">0.000000</td>
</tr>
<tr class="even">
<td align="left">V32</td>
<td align="right">2.8817970</td>
<td align="right">7.7711105</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V44</td>
<td align="right">3.0154479</td>
<td align="right">0.8022216</td>
<td align="right">4.319940</td>
</tr>
<tr class="even">
<td align="left">V39</td>
<td align="right">3.0934591</td>
<td align="right">0.7034846</td>
<td align="right">4.502128</td>
</tr>
<tr class="odd">
<td align="left">V37</td>
<td align="right">3.3454581</td>
<td align="right">0.8436842</td>
<td align="right">4.820022</td>
</tr>
<tr class="even">
<td align="left">V17</td>
<td align="right">3.3606302</td>
<td align="right">0.7580712</td>
<td align="right">4.894597</td>
</tr>
<tr class="odd">
<td align="left">V46</td>
<td align="right">3.3678171</td>
<td align="right">0.9310958</td>
<td align="right">4.804038</td>
</tr>
<tr class="even">
<td align="left">V36</td>
<td align="right">3.4872152</td>
<td align="right">1.2259491</td>
<td align="right">4.820022</td>
</tr>
<tr class="odd">
<td align="left">V7</td>
<td align="right">3.5999626</td>
<td align="right">1.9421882</td>
<td align="right">4.577067</td>
</tr>
<tr class="even">
<td align="left">V16</td>
<td align="right">3.6023687</td>
<td align="right">3.0291498</td>
<td align="right">3.940228</td>
</tr>
<tr class="odd">
<td align="left">V27</td>
<td align="right">3.9114160</td>
<td align="right">2.7317811</td>
<td align="right">4.606701</td>
</tr>
<tr class="even">
<td align="left">V31</td>
<td align="right">4.2438797</td>
<td align="right">11.4441295</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">V45</td>
<td align="right">4.6313000</td>
<td align="right">0.8321081</td>
<td align="right">6.870571</td>
</tr>
<tr class="even">
<td align="left">V13</td>
<td align="right">6.0729518</td>
<td align="right">2.6020604</td>
<td align="right">8.118721</td>
</tr>
<tr class="odd">
<td align="left">V9</td>
<td align="right">6.1685352</td>
<td align="right">0.6752631</td>
<td align="right">9.406310</td>
</tr>
<tr class="even">
<td align="left">V10</td>
<td align="right">6.2532734</td>
<td align="right">0.1409472</td>
<td align="right">9.855923</td>
</tr>
<tr class="odd">
<td align="left">V12</td>
<td align="right">7.1804369</td>
<td align="right">0.3496059</td>
<td align="right">11.206579</td>
</tr>
<tr class="even">
<td align="left">V11</td>
<td align="right">8.3466767</td>
<td align="right">0.0154652</td>
<td align="right">13.257153</td>
</tr>
</tbody>
</table>
<p>(The columns each sum up to 100.)</p>
</div>
<div id="caretstack" class="section level2">
<h2>caretStack</h2>
<p>caretStack allows us to move beyond simple blends of models to using
“meta-models” to ensemble collections of predictive models. DO NOT use
the <code>trainControl</code> object you used to fit the training models
to fit the ensemble. The re-sampling indexes will be wrong. Fortunately,
you don”t need to be fastidious with re-sampling indexes for caretStack,
as it only fits one model, and the defaults <code>train</code> uses will
usually work fine:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>glm_ensemble <span class="ot">&lt;-</span> <span class="fu">caretStack</span>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  model_list,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">&quot;glm&quot;</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric=</span><span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl=</span><span class="fu">trainControl</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">method=</span><span class="st">&quot;boot&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">number=</span><span class="dv">10</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions=</span><span class="st">&quot;final&quot;</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">classProbs=</span><span class="cn">TRUE</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">summaryFunction=</span>twoClassSummary</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>model_preds2 <span class="ot">&lt;-</span> model_preds</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>model_preds2<span class="sc">$</span>ensemble <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm_ensemble, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>CF <span class="ot">&lt;-</span> <span class="fu">coef</span>(glm_ensemble<span class="sc">$</span>ens_model<span class="sc">$</span>finalModel)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colAUC</span>(model_preds2, testing<span class="sc">$</span>Class)</span></code></pre></div>
<pre><code>##               glm     rpart  ensemble
## M vs. R 0.7137346 0.7746914 0.8140432</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>CF<span class="sc">/</span><span class="fu">sum</span>(CF)</span></code></pre></div>
<pre><code>##       glm     rpart 
## 0.3708346 0.6291654</code></pre>
<p>Note that <code>glm_ensemble$ens_model</code> is a regular caret
object of class <code>train</code>. The glm-weighted model weights (glm
vs rpart) and test-set AUCs are extremely similar to the caretEnsemble
greedy optimization.</p>
<p>We can also use more sophisticated ensembles than simple linear
weights, but these models are much more susceptible to over-fitting, and
generally require large sets of resamples to train on (n=50 or higher
for bootstrap samples). Lets try one anyways:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;gbm&quot;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gbm_ensemble <span class="ot">&lt;-</span> <span class="fu">caretStack</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  model_list,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">method=</span><span class="st">&quot;gbm&quot;</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose=</span><span class="cn">FALSE</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">tuneLength=</span><span class="dv">10</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">metric=</span><span class="st">&quot;ROC&quot;</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trControl=</span><span class="fu">trainControl</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">method=</span><span class="st">&quot;boot&quot;</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">number=</span><span class="dv">10</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">savePredictions=</span><span class="st">&quot;final&quot;</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">classProbs=</span><span class="cn">TRUE</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">summaryFunction=</span>twoClassSummary</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>model_preds3 <span class="ot">&lt;-</span> model_preds</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>model_preds3<span class="sc">$</span>ensemble <span class="ot">&lt;-</span> <span class="fu">predict</span>(gbm_ensemble, <span class="at">newdata=</span>testing, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colAUC</span>(model_preds3, testing<span class="sc">$</span>Class)</span></code></pre></div>
<pre><code>##               glm     rpart  ensemble
## M vs. R 0.7137346 0.7746914 0.8009259</code></pre>
<p>In this case, the sophisticated ensemble is no better than a simple
weighted linear combination. Non-linear ensembles seem to work best when
you have:</p>
<ol style="list-style-type: decimal">
<li>Lots of data.</li>
<li>Lots of models with similar accuracies.</li>
<li>Your models are uncorrelated: each one seems to capture a different
aspect of the data, and different models perform best on different
subsets of the data.</li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
